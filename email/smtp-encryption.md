# SMTP の通信暗号化

## 概要

- "SMTP over TLS/SSL" と "STARTTLS" の2つの方法がある。
- ともに TLS／SSL を使って通信を暗号化する。
  - _メールデータを暗号化するわけではない。_
- ともに全ての中継先での暗号化を保証するものではない。
  - _途中から平文で送信されることもある。_

## SMTP over TLS/SSL 

- SMTPS とも呼ばれる。
- コネクションの確立を SSL(TLS) で行う。
  - コネクション自体が暗号化される。
  - アプリケーション層である SMTP には影響しない。
- SMTP サーバは専用のポートで待ち受ける。
  - 一般に 465 が使用される。
  - _1998 年の STARTTLS の制定を機に well-known ポートの定義から外されてしまった。_

## STARTTLS

- SMTP の STARTTLS 拡張は RFC 3207 で規定されている。
  - STARTTLS それ自体は SMTP に限った仕様ではない。
- 平文で通信を開始して、途中から暗号化を開始する。
  - 暗号化の開始には、受信側の合意が必要となる。
  - 基本的に、受信側の合意が得られなかった場合は平文で通信を継続する。
- _中間者攻撃によって平文で送られてしまうことがある。_
  - 中間者が送信側に「合意しない」という嘘の回答を送ることで実現してしまう。
