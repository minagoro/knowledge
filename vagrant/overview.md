# Vagrant

## Vagrant とは？

- HashiCorp 社の開発する DevOps ツールの一つ。
- スペックファイルを元に、ホストを対象プラットフォーム上に実際に構築する。
- 一般的には、仮想化基盤を利用した開発環境の構築に利用される。
- 多くのプラットフォームをサポートする。（Provider）
- 構築プラットフォームに非依存の CLI でコマンド操作できる。（```vagrant```）
- 構築プラットフォームに非依存の共通形式でホストのスペックを記述できる。（Vagrantfile）
- SSH やネットワークの設定までを Vagrant が設定する。
- プロビジョニング方法の指定すれば、構築時にこれを併せて実行することもできる。
- スペックファイルは複数ホストの定義をサポートしており、
  これを利用して必要な一連のホストを一度に構築することもできる。

## Provider とは？

- 各プラットフォームへのサポートは Provider と呼ばれるプラグイン形式で実装されている。
- デフォルトで VirtualBox が選択されるが、VMWare / Docker / Hyper-V にも対応する。
- サードパーティ製 Provider を導入することで、AWS / libvirt (QEMU/KVM) などにも対応可能。

## Vagrantfile とは？

- 構築するホストのスペックを定義するファイル。
- CPU／ストレージといったハードウェア的な指定だけでなく、
  ホスト名／ネットワークといったソフトウェア的な指定も含む。
- DSL として mruby を採用していて、Ruby ユーザにとって慣れたシンタックスで記述できる。
- Provider が提供するプラットフォーム依存の定義項目も存在していて、
  これを利用することでポータビリティが失われるものの詳細な構築指示が可能。

## Vagrant Box とは？

- いわゆるホストのベースイメージ。
- プラットフォームごとに個別に管理される。
- 自作することも可能だが、少々煩雑なのでハードルは高い。
- オープンなリポジトリがホスティングされていて、多数の Box が公開されている。

## 他のツールとの違い

- 直接プラットフォームを操作するよりも便利なことが多い。
  Box をダウンロードすることでインストール完了後のスナップショットが簡単に手に入れられるし、
  スペックを選択するために GUI をポチポチする必要もない。
- Vagrantfile が複数ホストの定義に対応している点で Docker-Compose と競合するが、
  Docker 依存である Docker-Compose に対して、Vagrant はプラットフォーム非依存であり汎用性が高い。

## 使用した感想

- SSH やネットワークの設定機能が素晴らしい。
  - すぐに作業が始められるホストが、簡単なコマンド実行で構築できる。
  - 煩雑なネットワーク構築作業を自動化できる。
  - SSH が済んでいるので、オーケストレーションツールに管理をそのまま引き渡せる。
- 簡単に VM を構築できるが Docker と同じ感覚でやっているとすぐにメモリが足りなくなる。
  - あくまでコンテナではなく VM なので、必要最低限の数を立てるという運用が正しい。